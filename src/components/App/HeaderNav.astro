---
import AppHeaderButton from '@/components/App/HeaderButton.astro';

const classNavList = 'flex items-center justify-start';
const classNavListLink = 'block h-full px-2';
---

<script>
  import gsap from 'gsap';

  const navs = [
    ...document.querySelectorAll('[data-js=header-nav]'),
  ] as HTMLElement[];

  navs.forEach(nav => {
    const navList = nav.querySelector('[data-js-header-nav-list]');
    const navItems = nav.querySelectorAll('[data-js-header-nav-item]');
    const pill = nav.querySelector('[data-js-header-nav-pill]');

    console.log('navItems', navItems);
    console.log('pill', pill);

    let pillActive = false;
    const ease = 'power2.inOut';

    const updatePill = (target: any) => {
      const { offsetWidth, offsetLeft } = target.firstElementChild;

      if (pillActive) {
        gsap.to(pill, {
          opacity: 1,
          width: offsetWidth,
          left: offsetLeft,
          duration: 0.3,
          ease,
        });
      } else {
        gsap.set(pill, {
          width: offsetWidth,
          left: offsetLeft,
        });

        gsap.to(pill, {
          opacity: 1,
          duration: 0.3,
          ease,
          onStart: () => {
            pillActive = true;
          },
        });
      }
    };

    const hidePill = () => {
      gsap.to(pill, {
        opacity: 0,
        duration: 0.3,
        ease,
      });
    };

    navList?.addEventListener('mouseleave', () => (pillActive = false));

    navItems.forEach(item => {
      item.addEventListener('mouseenter', e => updatePill(e.target));
      item.addEventListener('mouseleave', hidePill);
    });
  });
</script>

<div data-js="header-nav" class="relative flex items-center h-full">
  <ul data-js-header-nav-list class={classNavList}>
    <li>
      <a data-js-header-nav-item class={classNavListLink} href="/">
        <AppHeaderButton text="Services" />
      </a>
    </li>

    <li>
      <a data-js-header-nav-item class={classNavListLink} href="/">
        <AppHeaderButton text="Our Work" />
      </a>
    </li>

    <li>
      <a data-js-header-nav-item class={classNavListLink} href="/">
        <AppHeaderButton text="Agency" />
      </a>
    </li>
  </ul>

  <span
    data-js-header-nav-pill
    class="header-nav__pill block bg-yellow rounded-12 h-full opacity-0"
  >
  </span>
</div>

<style>
  .header-nav__pill {
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
  }
</style>
